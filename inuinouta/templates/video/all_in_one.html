{% load static %}
<html>
	<head>
		<title>いぬいのうた | 戌亥とこ非公式ファンサイト</title>

<script src="https://kit.fontawesome.com/14c8f655ab.js" crossorigin="anonymous"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-166010180-1"></script>
<script>
// for google analytics
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'UA-166010180-1');

// ここで指定したidの動画がプレイヤーに初期ロードされる
var initialVideoId = "{{ initial_video.video_id }}";
var initialVideoStart  = {{ initial_song.start_at }};

</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="{% static "js/common.js" %}"></script>
	<script>

/* 全ての曲と動画情報を書き出す */
var songList = new SongList();
var videoList = new VideoList();
{% for v in videos %}
videoList.addVideo("{{ v.video_id }}", "{{ v.title }}");
{% for s in v.sorted_song_set %}
songList.addSong("{{ s.id }}", "{{ v.video_id }}", "{{ s.title }}", "{{ s.artist}}", {{ s.start_at }}, {{ s.end_at }} );
{% endfor %}{% endfor %}
 
var songPlaying = songList.searchSong('{{initial_video.video_id}}', {{ initial_song.start_at }});
function updateTweetData() {
	var intentUrl = "https://twitter.com/intent/tweet?";
	var text = "いぬいのうたで「" + videoList.videos[songPlaying.video_id].title + "/" + songPlaying.artist + "」を再生中";
	var url = "https://inui-no-uta.herokuapp.com/?vid=" + songPlaying.video_id + "&sid=" + songPlaying.id;
	var hashtag = "いぬいのうた";

	var params = new URLSearchParams({
		"text": text,
		"url": url,
		"hashtags": hashtag
	});

	var obj = document.getElementById("twitter-share-link");
	obj.setAttribute("href", 
		intentUrl + params.toString()
	);
}

var firstPlay = false;
var checkPlayingSong = function() {
	if (!firstPlay) {
		return;
	}
	var video_id = player.getVideoData().video_id;
	var playing = songList.searchSong(video_id, player.getCurrentTime());
	songPlaying = playing;
	if (playing) {
		updateSongInfo(video_id, playing.title  + " / " + playing.artist, videoList.videos[playing.video_id].title);
		updateTweetData();
	} else {
		updateSongInfo(video_id, "--- / ---", videoList.videos[video_id].title);
	}
}

setInterval(checkPlayingSong, 1000);


</script>
<style>
body {
	margin: 0;     overflow: hidden;
}
div#main {
	position: absolute;
	top: 0;
	right: 0;
	left: 0;
	bottom: 0;
}
div#content {
	height: calc(100% - 90px);
}
div#header {
	z-index: 100;
	width: 100%;
	background-color: #9d3757;
	padding: 10px 0px 10px 20px;
	margin-bottom: 10px;
	border-right: 10px solid #fff;
	border-bottom: 10px solid #fff;
	position: fixed;
}
div#header h1 {
	color: #fff;
	font-size: 30px;
	font-weight: bold;
	margin: 0px;
}
div#body-content {
	z-index: 90;
}
div#player-wrapper {
	position: fixed;
	z-index: 110;
	width: 720px;
	top: 70px;
	padding-left: 10px;
}
div#player-wrapper .player-message {
	margin-top:20px;
}
div#player-wrapper .player-message h2 {
	font-size: 16px;
	font-weight: normal;
	margin-bottom: 5px;
}
div#player-wrapper .player-message p {
	font-size: 14px;
	color: #333;
	margin-top: 5px;
	margin-left: 10px;
}
div#video-wrapper {
	position: relative;
	top: 70px;
	height: inherit;
	margin-left: 720px;
	padding-left: 10px;
	overflow-y: scroll;
	overflow-x: hidden;
}
div.video {
	position: static;
	padding : 10px;
	margin-left: 10px;
	border-bottom: 1px solid #ccc;
}
div.video-thumb {
	position: relative;
	float: left;
	width: 128px;
	height: 72px;
	background-color: #eee;
}
div.video-thumb img {
	z-index: 90;
	width: 128px;
	height: 72px;
}
div.video-info {
	z-index: 80;
	position: static;
	padding-top: 5px;
	padding-left: 140px;

}
div.video-info span.title {
	font-size: 16px;
}
div.video-info span.date {
	font-size: 12px;
	color: #666;
}
div.song-list {
	position: relative;
	clear: both;
}
div#navigation-wrapper {
	box-shadow: 0 0 8px rgba(0,0,0,.4);
	z-index: 120;
	background-color: #fff;
	display: flex;
	position: relative;
	height: 90px;
	width: 100%;
}
div#navigation-left {
	flex: 1;
	height: 90px;
	position: relative;
	white-space: nowrap;
}
div#navigation-thumb  {
	float: left;
	margin-right: 10px;
}
div#navigation-thumb img {
	height: 84px;
	margin: 3px;
}
div#navigation-song-info {
	align-items: center;
	display: flex;
	height: 100%;
}
div#navigation-song-info-text {
	flex: 1;
	overflow: hidden;
}
div#navigation-song-title {
	text-overflow: ellipsis;
	overflow: hidden;
}
div#navigation-video-title {
	font-size: 14px;
	color: #666;
	text-overflow: ellipsis;
	overflow: hidden;

}
div#navigation-middle {
	display: flex;
	/* background-color: #cfc; */
	align-items: center;
	height: 100%;
	margin: 0px 20px 0px 20px;
}
div#navigation-right {
	display: flex;
	flex: 1;
	justify-content: flex-end;
	height: 100%;
	align-items: center;
	/* background-color: #ccf; */
}
div#twitter-share {
	margin: 10px 30px;
}

div.song-list ul {
	padding-top: 10px;
	margin-top: 0px;
	margin-bottom: 0px;
}
div.song-list ul {
	font-size: 16px;
}
.fa-color-inui {
	color: #9d3757;
}
.fa-color-inui:hover {
	color: #d56789;
}
.fa-color-tweet {
	color: #00acee;
}

</style>
	</head>
	<body>
<div id="main">
	<div id="content">
		<div id="header">
			<h1>いぬいのうた</h1>
		</div>
		<div id="player-wrapper">
			<div id="youtube-player"></div>
			<div class="player-message">
				<h2>使い方</h2>
				<p>
				曲名をクリックすると動画を読み込んで曲の頭出しをします。<br />
				<br />
				サムネイルをクリックすると元動画に飛べます。また曲名リンクから新しいウィンドウを開いても元動画で頭出しができます。コメントを見たい場合などはそちらからどうぞ。
				</p>
			</div>
			<div class="player-message">
				<h2>このサイトについて</h2>
				<p>
				にじさんじ所属のバーチャルライバー、<strong><a href="https://www.youtube.com/channel/UCXRlIK3Cw_TJIQC5kSJJQMg?sub_confirmation=1">戌亥とこ</a></strong>さんの歌を視聴しやすいようにまとめた<u>非公式ファンサイト</u>です。
				戌亥とこさん及び"いちから株式会社"とは直接の関係はありません。
				</p>
				<p>
				ご意見、不具合報告等はツイッター(<a href="https://twitter.com/ino463">@ino463</a>)または<a href="https://marshmallow-qa.com/ino463">こちら</a>にでも。
				</p>
			</div>
		</div>
		<div id="video-wrapper">
		{% for v in videos %}
			<div class="video">
				<div class="video-thumb"><a href="{{ v.url }}"><img src="http://img.youtube.com/vi/{{ v.video_id }}/mqdefault.jpg"></a></div>
				<div class="video-info">
					<span class="title">{{ v.title }}</span><br />
					<span class="date">{{ v.published_at|date:"Y/m/d" }}</span>
				</div>
				<div class="song-list">
					<ul>
					{% for s in v.sorted_song_set %}
					<li><a href="{{v.url }}&t={{ s.start_at }}" class="song-title" onclick="playSong('{{ v.video_id}}', '{{ s.title }}' + ' / ' + '{{ s.artist }}' , '{{ v.title }}', {{ s.start_at }})">{{ s.title }}</a> / {{ s.artist }}
					{% endfor %}
					</ul>
				</div>
			</div>
		{% endfor %}
		</div>
	</div><!-- content end -->
	<div id="navigation-wrapper">
		<div id="navigation-left">
			<div id="navigation-thumb"><img src="http://img.youtube.com/vi/{{ initial_video.video_id }}/mqdefault.jpg" id="playing-thumb"></div>
			<div id="navigation-song-info">
				<div id="navigation-song-info-text">
					<div id="navigation-song-title">{{ initial_song.title}} / {{ initial_song.artist }}</div>
					<div id="navigation-video-title">{{ initial_video.title }}</div>
				</div>
			</div>
		</div>
		<div id="navigation-middle">
			<a href="#" id="control-icon" onClick="changePlayingState()"><i class="far fa-play-circle fa-4x fa-color-inui"></i></a>
		</div>
		<div id="navigation-right">
			<div id="twitter-share">
				<a href="#" id="twitter-share-link" target="inui_no_uta">
					<i class="fab fa-twitter fa-2x fa-color-tweet"></i>
				</a>
			</div>
		</div>
	</div>
</div><!-- main end -->
<script>
updateTweetData();
</script>
</body>
</html>
